<!-- Header Section -->
<section class="projects-header">
  <div class="container mx-auto px-5 py-20">
    <div class="text-center" data-aos="fade-up">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Projets Associatifs</h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Découvrez les projets en cours et à venir de l'association
      </p>
    </div>
  </div>
</section>

<!-- Loading State -->
<div *ngIf="isLoading" class="container mx-auto px-5 py-20">
  <div class="text-center">
    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue"></div>
    <p class="mt-4 text-gray-600">Chargement des projets...</p>
  </div>
</div>

<!-- Projects Content -->
<div *ngIf="!isLoading" class="container mx-auto px-5 py-12">
  <!-- Filters -->
  <div class="mb-8 flex flex-wrap gap-4" data-aos="fade-up">
    <div class="flex-1 min-w-[200px]">
      <label class="block text-sm font-semibold text-gray-700 mb-2">Statut</label>
      <select 
        [(ngModel)]="statusFilter" 
        (change)="onStatusFilterChange()"
        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent">
        <option value="all">Tous les statuts</option>
        <option value="planning">Planifiés</option>
        <option value="in_progress">En cours</option>
        <option value="completed">Terminés</option>
      </select>
    </div>
    <div class="flex-1 min-w-[200px]">
      <label class="block text-sm font-semibold text-gray-700 mb-2">Catégorie</label>
      <select 
        [(ngModel)]="categoryFilter" 
        (change)="onCategoryFilterChange()"
        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent">
        <option value="all">Toutes les catégories</option>
        <option value="culturel">Culturel</option>
        <option value="sportif">Sportif</option>
        <option value="social">Social</option>
        <option value="environnement">Environnement</option>
        <option value="autre">Autre</option>
      </select>
    </div>
  </div>

  <!-- Projects Grid -->
  <div *ngIf="filteredProjects.length > 0" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
    <article
      *ngFor="let project of filteredProjects; let i = index"
      class="group bg-white rounded-2xl overflow-hidden border border-gray-100 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2 h-full flex flex-col cursor-pointer"
      [attr.data-aos]="'fade-up'" [attr.data-aos-delay]="i * 100"
      (click)="openProjectDetail(project)">
      
      <!-- Image -->
      <div class="relative h-48 overflow-hidden">
        <img 
          [src]="project.imageUrl || 'assets/images/franek3.webp'" 
          [alt]="project.title" 
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
        <div class="absolute top-4 left-4 flex gap-2 flex-wrap">
          <span class="px-3 py-1 rounded-lg text-xs font-semibold text-white shadow-sm"
            [ngClass]="{
              'bg-blue-500': project.status === 'planning',
              'bg-green-500': project.status === 'in_progress',
              'bg-gray-500': project.status === 'completed',
              'bg-red-500': project.status === 'cancelled'
            }">
            {{ getStatusLabel(project.status) }}
          </span>
          <span class="px-3 py-1 rounded-lg text-xs font-semibold bg-purple-500 text-white shadow-sm">
            {{ getCategoryLabel(project.category) }}
          </span>
        </div>
      </div>

      <!-- Content -->
      <div class="p-6 flex-1 flex flex-col">
        <div class="flex items-center justify-between mb-3">
          <span class="px-2 py-1 rounded text-xs font-semibold"
            [ngClass]="{
              'bg-yellow-100 text-yellow-700': project.priority === 'low',
              'bg-orange-100 text-orange-700': project.priority === 'medium',
              'bg-red-100 text-red-700': project.priority === 'high' || project.priority === 'urgent'
            }">
            {{ getPriorityLabel(project.priority) }}
          </span>
          <span *ngIf="project.startDate" class="text-xs text-gray-500">
            <i class="fas fa-calendar-alt mr-1"></i>
            {{ formatDate(project.startDate) }}
          </span>
        </div>

        <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-brand-blue transition-colors">
          {{ project.title }}
        </h3>
        <p class="text-gray-600 mb-4 flex-1 line-clamp-3">
          {{ project.description }}
        </p>

        <!-- Progress Bar -->
        <div class="mb-4">
          <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
            <span>Progression</span>
            <span>{{ project.progress || 0 }}%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-brand-blue h-2 rounded-full transition-all" [style.width.%]="project.progress || 0"></div>
          </div>
        </div>

        <!-- Budget -->
        <div *ngIf="project.budget" class="text-sm text-gray-600 mb-4">
          <i class="fas fa-euro-sign mr-1"></i>
          Budget: {{ project.budget }}€
        </div>

        <button
          class="flex items-center justify-between w-full p-3 rounded-xl bg-gray-50 group-hover:bg-brand-blue group-hover:text-white transition-colors">
          <span class="font-medium text-sm">Voir les détails</span>
          <i class="fa-solid fa-arrow-right text-xs"></i>
        </button>
      </div>
    </article>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredProjects.length === 0" class="text-center py-24 bg-gray-50 rounded-3xl border border-gray-100">
    <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-6 text-gray-400 text-3xl">
      <i class="fas fa-project-diagram"></i>
    </div>
    <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun projet</h3>
    <p class="text-gray-600">Aucun projet ne correspond à vos critères de recherche.</p>
  </div>
</div>

<!-- Project Detail Modal -->
<div *ngIf="showDetailModal && selectedProject" 
     class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" 
     (click)="closeDetailModal()">
  <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" 
       (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between z-10">
      <div class="flex-1">
        <div class="flex items-center gap-3 mb-2">
          <span class="px-3 py-1 rounded-lg text-xs font-semibold text-white shadow-sm"
            [ngClass]="{
              'bg-blue-500': selectedProject.status === 'planning',
              'bg-green-500': selectedProject.status === 'in_progress',
              'bg-gray-500': selectedProject.status === 'completed',
              'bg-red-500': selectedProject.status === 'cancelled'
            }">
            {{ getStatusLabel(selectedProject.status) }}
          </span>
          <span class="px-3 py-1 rounded-lg text-xs font-semibold bg-purple-500 text-white shadow-sm">
            {{ getCategoryLabel(selectedProject.category) }}
          </span>
          <span class="px-3 py-1 rounded-lg text-xs font-semibold"
            [ngClass]="{
              'bg-yellow-100 text-yellow-700': selectedProject.priority === 'low',
              'bg-orange-100 text-orange-700': selectedProject.priority === 'medium',
              'bg-red-100 text-red-700': selectedProject.priority === 'high' || selectedProject.priority === 'urgent'
            }">
            Priorité: {{ getPriorityLabel(selectedProject.priority) }}
          </span>
        </div>
        <h2 class="text-2xl font-bold text-gray-900">{{ selectedProject.title }}</h2>
      </div>
      <button (click)="closeDetailModal()" class="ml-4 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      <!-- Image -->
      <div *ngIf="selectedProject.imageUrl" class="mb-6 rounded-xl overflow-hidden">
        <img [src]="selectedProject.imageUrl" [alt]="selectedProject.title" class="w-full h-auto">
      </div>

      <!-- Description -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Description</h3>
        <p class="text-gray-600 leading-relaxed">{{ selectedProject.description }}</p>
      </div>

      <!-- Details Grid -->
      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div *ngIf="selectedProject.startDate">
          <h4 class="text-sm font-semibold text-gray-700 mb-1">Date de début</h4>
          <p class="text-gray-600">
            <i class="fas fa-calendar-alt mr-2 text-brand-blue"></i>
            {{ formatDate(selectedProject.startDate) }}
          </p>
        </div>
        <div *ngIf="selectedProject.endDate">
          <h4 class="text-sm font-semibold text-gray-700 mb-1">Date de fin prévue</h4>
          <p class="text-gray-600">
            <i class="fas fa-calendar-check mr-2 text-brand-blue"></i>
            {{ formatDate(selectedProject.endDate) }}
          </p>
        </div>
        <div *ngIf="selectedProject.budget">
          <h4 class="text-sm font-semibold text-gray-700 mb-1">Budget</h4>
          <p class="text-gray-600">
            <i class="fas fa-euro-sign mr-2 text-brand-blue"></i>
            {{ selectedProject.budget }}€
          </p>
        </div>
        <div *ngIf="selectedProject.assignedToFirstName">
          <h4 class="text-sm font-semibold text-gray-700 mb-1">Responsable</h4>
          <p class="text-gray-600">
            <i class="fas fa-user mr-2 text-brand-blue"></i>
            {{ selectedProject.assignedToFirstName }} {{ selectedProject.assignedToLastName }}
          </p>
        </div>
      </div>

      <!-- Progress -->
      <div class="mb-6">
        <div class="flex items-center justify-between text-sm font-semibold text-gray-700 mb-2">
          <span>Progression du projet</span>
          <span>{{ selectedProject.progress || 0 }}%</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3">
          <div class="bg-brand-blue h-3 rounded-full transition-all" [style.width.%]="selectedProject.progress || 0"></div>
        </div>
      </div>
    </div>
  </div>
</div>


