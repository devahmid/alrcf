<!-- Header Section -->
<section class="events-header">
  <div class="container mx-auto px-5 py-20">
    <div class="text-center" data-aos="fade-up">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Événements</h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Découvrez les prochains événements organisés par l'association
      </p>
    </div>
  </div>
</section>

<!-- Loading State -->
<div *ngIf="isLoading" class="container mx-auto px-5 py-20">
  <div class="text-center">
    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue"></div>
    <p class="mt-4 text-gray-600">Chargement des événements...</p>
  </div>
</div>

<!-- Events Content -->
<div *ngIf="!isLoading" class="container mx-auto px-5 py-12">
  <!-- Events Grid -->
  <div *ngIf="filteredEvents.length > 0" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
    <article
      *ngFor="let event of filteredEvents; let i = index"
      class="group bg-white rounded-2xl overflow-hidden border border-gray-100 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2 h-full flex flex-col cursor-pointer"
      [attr.data-aos]="'fade-up'" [attr.data-aos-delay]="i * 100"
      (click)="openEventDetail(event)">

      <!-- Image -->
      <div class="relative h-64 overflow-hidden bg-gray-100">
        <img
          *ngIf="event.imageUrl"
          [src]="event.imageUrl"
          [alt]="event.title"
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
        <div *ngIf="!event.imageUrl" class="w-full h-full flex items-center justify-center bg-gradient-to-br from-brand-blue/10 to-purple-500/10">
          <i class="fas fa-calendar-alt text-6xl text-gray-300"></i>
        </div>
        <div class="absolute top-4 left-4">
          <span class="px-3 py-1 bg-white/90 backdrop-blur-md rounded-lg text-sm font-bold text-gray-900 shadow-sm">
            {{ formatDateShort(event.startDate) }}
          </span>
        </div>
        <div class="absolute top-4 right-4">
          <span class="px-3 py-1 rounded-lg text-xs font-semibold text-white shadow-sm"
            [ngClass]="{
              'bg-red-500': getEventStatus(event) === 'soon',
              'bg-green-500': getEventStatus(event) === 'upcoming',
              'bg-gray-500': getEventStatus(event) === 'past'
            }">
            {{ getEventStatus(event) === 'soon' ? 'Bientôt' : getEventStatus(event) === 'upcoming' ? 'À venir' : 'Passé' }}
          </span>
        </div>
      </div>

      <!-- Content -->
      <div class="p-6 flex-1 flex flex-col">
        <div class="flex items-center gap-2 mb-3 text-sm text-gray-500">
          <i class="fas fa-map-marker-alt text-brand-blue"></i>
          <span>{{ event.location }}</span>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-brand-blue transition-colors line-clamp-2">
          {{ event.title }}
        </h3>
        <p class="text-gray-600 mb-6 flex-1 line-clamp-3">
          {{ event.description }}
        </p>

        <!-- Participants -->
        <div *ngIf="event.maxParticipants" class="mb-4">
          <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
            <span>Participants</span>
            <span>{{ event.currentParticipants || 0 }}/{{ event.maxParticipants }}</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-brand-blue h-2 rounded-full transition-all"
              [style.width.%]="((event.currentParticipants || 0) / event.maxParticipants) * 100">
            </div>
          </div>
        </div>

        <button
          class="flex items-center justify-between w-full p-3 rounded-xl bg-gray-50 group-hover:bg-brand-blue group-hover:text-white transition-colors">
          <span class="font-medium text-sm">Voir les détails</span>
          <i class="fa-solid fa-arrow-right text-xs"></i>
        </button>
      </div>
    </article>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredEvents.length === 0" class="text-center py-24 bg-gray-50 rounded-3xl border border-gray-100">
    <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-6 text-gray-400 text-3xl">
      <i class="fas fa-calendar-alt"></i>
    </div>
    <h3 class="text-xl font-bold text-gray-900 mb-2">Aucun événement</h3>
    <p class="text-gray-600">Revenez bientôt pour découvrir nos prochains événements.</p>
    <!-- Debug info -->
    <div class="mt-4 text-xs text-gray-400" *ngIf="events.length > 0">
      ({{ events.length }} événement(s) chargé(s) mais non affiché(s))
    </div>
  </div>
</div>

<!-- Event Detail Modal -->
<div *ngIf="showDetailModal && selectedEvent" 
     class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" 
     (click)="closeDetailModal()">
  <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" 
       (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between z-10">
      <div class="flex-1">
        <div class="flex items-center gap-3 mb-2">
          <span class="px-3 py-1 rounded-lg text-xs font-semibold text-white shadow-sm"
            [ngClass]="{
              'bg-red-500': getEventStatus(selectedEvent) === 'soon',
              'bg-green-500': getEventStatus(selectedEvent) === 'upcoming',
              'bg-gray-500': getEventStatus(selectedEvent) === 'past'
            }">
            {{ getEventStatus(selectedEvent) === 'soon' ? 'Bientôt' : getEventStatus(selectedEvent) === 'upcoming' ? 'À venir' : 'Passé' }}
          </span>
        </div>
        <h2 class="text-2xl font-bold text-gray-800">{{ selectedEvent.title }}</h2>
      </div>
      <button (click)="closeDetailModal()" class="text-gray-400 hover:text-gray-600 transition-colors ml-4">
        <i class="fa-solid fa-times text-2xl"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      <!-- Image -->
      <div *ngIf="selectedEvent.imageUrl" class="mb-6 rounded-xl overflow-hidden">
        <img [src]="selectedEvent.imageUrl" [alt]="selectedEvent.title" class="w-full h-auto max-h-96 object-cover">
      </div>

      <!-- Event Info -->
      <div class="mb-6 grid md:grid-cols-2 gap-4">
        <div class="p-4 bg-gray-50 rounded-xl">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-1">
            <i class="fas fa-calendar text-brand-blue"></i>
            <span><strong>Date de début:</strong></span>
          </div>
          <p class="text-gray-900 font-medium">{{ formatDate(selectedEvent.startDate) }}</p>
        </div>
        <div class="p-4 bg-gray-50 rounded-xl" *ngIf="selectedEvent.endDate">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-1">
            <i class="fas fa-calendar-check text-brand-blue"></i>
            <span><strong>Date de fin:</strong></span>
          </div>
          <p class="text-gray-900 font-medium">{{ formatDate(selectedEvent.endDate) }}</p>
        </div>
        <div class="p-4 bg-gray-50 rounded-xl">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-1">
            <i class="fas fa-map-marker-alt text-brand-blue"></i>
            <span><strong>Lieu:</strong></span>
          </div>
          <p class="text-gray-900 font-medium">{{ selectedEvent.location }}</p>
        </div>
        <div class="p-4 bg-gray-50 rounded-xl" *ngIf="selectedEvent.maxParticipants">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-1">
            <i class="fas fa-users text-brand-blue"></i>
            <span><strong>Participants:</strong></span>
          </div>
          <p class="text-gray-900 font-medium">{{ selectedEvent.currentParticipants || 0 }}/{{ selectedEvent.maxParticipants }}</p>
        </div>
      </div>

      <!-- Description -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Description</h3>
        <p class="text-gray-700 whitespace-pre-line leading-relaxed text-lg">{{ selectedEvent.description }}</p>
      </div>

      <!-- Registration Info -->
      <div *ngIf="selectedEvent.registrationRequired" class="mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200">
        <div class="flex items-center gap-2 text-blue-800 font-semibold mb-2">
          <i class="fas fa-info-circle"></i>
          <span>Inscription requise</span>
        </div>
        <p class="text-blue-700 text-sm" *ngIf="selectedEvent.registrationDeadline">
          Date limite d'inscription : {{ formatDate(selectedEvent.registrationDeadline) }}
        </p>
      </div>

      <!-- Footer -->
      <div class="pt-6 border-t border-gray-200 flex items-center justify-between">
        <div class="text-sm text-gray-500">
          <i class="fas fa-calendar me-2"></i>
          Événement du {{ formatDate(selectedEvent.startDate) }}
        </div>
        <button
          (click)="closeDetailModal()"
          class="px-6 py-2 bg-brand-blue text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>

